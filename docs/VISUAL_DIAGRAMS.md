# ğŸ¨ Gogobe - ×ª×¨×©×™××™× ×•×™×–×•××œ×™×™×

## ğŸ—ï¸ ××¨×›×™×˜×›×˜×•×¨×” ×›×œ×œ×™×ª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GOGOBE ARCHITECTURE                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND (HTML + JavaScript)                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚Dashboard â”‚ â”‚  Prices  â”‚ â”‚   Map    â”‚ â”‚  Admin   â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP/REST
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API LAYER (FastAPI - Python)                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ Products â”‚ â”‚  Prices  â”‚ â”‚  Stores  â”‚ â”‚Managementâ”‚       â”‚
â”‚ â”‚   API    â”‚ â”‚   API    â”‚ â”‚   API    â”‚ â”‚   API    â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis      â”‚ â”‚ PostgreSQL   â”‚ â”‚  Scrapers    â”‚
â”‚   Cache      â”‚ â”‚   Database   â”‚ â”‚  (Python)    â”‚
â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ 95-99% Hit   â”‚ â”‚ 1.1M Prices  â”‚ â”‚ XML/HTML     â”‚
â”‚   Rate       â”‚ â”‚ 23K Products â”‚ â”‚  Parsing     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow - ××§×•×‘×¥ XML ×œ××—×™×¨ ×‘××¢×¨×›×ª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: DATA INGESTION                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“¥ XML File (Rami Levy / Shufersal)
    â”‚
    â”œâ”€ prices.xml.gz (100K products)
    â”œâ”€ stores.xml (464 stores)
    â””â”€ promos.xml (promotions)
    
    â–¼ Download & Extract
    
ğŸ“„ Parsed Data
    â”‚
    â”œâ”€ Chain: "×¨××™ ×œ×•×™" (7290027600007)
    â”œâ”€ Store: "×¨××™ ×œ×•×™ ×©×™×§××”" (001)
    â””â”€ Products: [{barcode, name, price}, ...]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: PROCESSING PIPELINE                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â–¼ Store Processing (15ms)
    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Get-or-Create Store                  â”‚
â”‚                                      â”‚
â”‚ 1. Check Redis Cache                 â”‚
â”‚    Key: "store:7290027600007_001"    â”‚
â”‚    â”œâ”€ HIT â†’ Return store_id          â”‚
â”‚    â””â”€ MISS â†’ Continue                â”‚
â”‚                                      â”‚
â”‚ 2. Check Database                    â”‚
â”‚    SELECT id FROM stores             â”‚
â”‚    WHERE chain_id=153 AND store_id=1 â”‚
â”‚    â”œâ”€ FOUND â†’ Cache & Return         â”‚
â”‚    â””â”€ NOT FOUND â†’ Continue           â”‚
â”‚                                      â”‚
â”‚ 3. Create New Store                  â”‚
â”‚    INSERT INTO stores (...)          â”‚
â”‚    RETURNING id                      â”‚
â”‚                                      â”‚
â”‚ 4. Cache Result                      â”‚
â”‚    Redis: SET key value EX 86400     â”‚
â”‚                                      â”‚
â”‚ Result: store_id = 12345             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â–¼ Product Processing (20ms)
    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Get-or-Create Product                â”‚
â”‚                                      â”‚
â”‚ 1. Check Redis Cache                 â”‚
â”‚    Key: "product:ean:7290000000001"  â”‚
â”‚    â”œâ”€ HIT (99%) â†’ Return product_id  â”‚
â”‚    â””â”€ MISS (1%) â†’ Continue           â”‚
â”‚                                      â”‚
â”‚ 2. Check Database                    â”‚
â”‚    SELECT id FROM products           â”‚
â”‚    WHERE ean='7290000000001'         â”‚
â”‚    â”œâ”€ FOUND â†’ Cache & Return         â”‚
â”‚    â””â”€ NOT FOUND â†’ Continue           â”‚
â”‚                                      â”‚
â”‚ 3. Create New Product                â”‚
â”‚    INSERT INTO products (...)        â”‚
â”‚    RETURNING id                      â”‚
â”‚                                      â”‚
â”‚ 4. Cache Result                      â”‚
â”‚    Redis: SET key value EX 86400     â”‚
â”‚                                      â”‚
â”‚ Result: product_id = 54321           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â–¼ Master Product Linking (250ms) ğŸ‘‘
    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Master Product Matching              â”‚
â”‚                                      â”‚
â”‚ Strategy 1: Barcode (70%)            â”‚
â”‚ â”œâ”€ Search: global_ean='7290000000001'â”‚
â”‚ â””â”€ FOUND â†’ master_id = 999           â”‚
â”‚                                      â”‚
â”‚ Strategy 2: AI Embeddings (25%)      â”‚
â”‚ â”œâ”€ Generate embedding                â”‚
â”‚ â”œâ”€ Similarity search                 â”‚
â”‚ â””â”€ Match > 90% â†’ Link                â”‚
â”‚                                      â”‚
â”‚ Strategy 3: LLM Creation (5%)        â”‚
â”‚ â”œâ”€ Extract attributes (GPT-4)        â”‚
â”‚ â”œâ”€ Generate master_id                â”‚
â”‚ â””â”€ Create new master product         â”‚
â”‚                                      â”‚
â”‚ Result: master_product_id = 999      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â–¼ Price Processing (1s for 1000 prices)
    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Batch Price Insert                   â”‚
â”‚                                      â”‚
â”‚ 1. Add to Queue                      â”‚
â”‚    priceQueue.append({               â”‚
â”‚      product_id: 54321,              â”‚
â”‚      store_id: 12345,                â”‚
â”‚      price: 5.90,                    â”‚
â”‚      master_product_id: 999 ğŸ‘‘       â”‚
â”‚    })                                â”‚
â”‚                                      â”‚
â”‚ 2. When Queue >= 1000:               â”‚
â”‚    BEGIN TRANSACTION;                â”‚
â”‚    FOR EACH price:                   â”‚
â”‚      SELECT upsert_price(...)        â”‚
â”‚    COMMIT;                           â”‚
â”‚                                      â”‚
â”‚ 3. Update Cache                      â”‚
â”‚    Redis: SET "price:54321:12345"    â”‚
â”‚           "5.90:ILS" EX 3600         â”‚
â”‚                                      â”‚
â”‚ Result: Price inserted! âœ…           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: ASYNC ENRICHMENT (Non-blocking)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â–¼ Geocoding (5 min) ğŸ—ºï¸
    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GPS Coordinates                      â”‚
â”‚                                      â”‚
â”‚ 1. Build query                       â”‚
â”‚    "×“×¨×š ×× ×—× ×‘×’×™×Ÿ 132, ×ª×œ ××‘×™×‘"     â”‚
â”‚                                      â”‚
â”‚ 2. Call OSM Nominatim                â”‚
â”‚    â†’ lat: 32.0668, lon: 34.7913      â”‚
â”‚                                      â”‚
â”‚ 3. Update Database                   â”‚
â”‚    UPDATE stores                     â”‚
â”‚    SET latitude=32.0668,             â”‚
â”‚        longitude=34.7913             â”‚
â”‚                                      â”‚
â”‚ Result: Store on map! ğŸ—ºï¸            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â–¼ Currency Conversion (15 min) ğŸ’±
    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USD Conversion                       â”‚
â”‚                                      â”‚
â”‚ 1. Get Exchange Rate                 â”‚
â”‚    ILS â†’ USD: 0.274                  â”‚
â”‚                                      â”‚
â”‚ 2. Convert                           â”‚
â”‚    5.90 ILS Ã— 0.274 = 1.62 USD       â”‚
â”‚                                      â”‚
â”‚ 3. Store Global Price                â”‚
â”‚    INSERT INTO global_prices (...)   â”‚
â”‚                                      â”‚
â”‚ Result: Global comparison ready! ğŸŒ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… COMPLETE!                                                 â”‚
â”‚                                                              â”‚
â”‚ Timeline:                                                    â”‚
â”‚ â€¢ 0ms    - XML received                                      â”‚
â”‚ â€¢ 15ms   - Store created/found                               â”‚
â”‚ â€¢ 20ms   - Product created/found                             â”‚
â”‚ â€¢ 250ms  - Master product linked ğŸ‘‘                          â”‚
â”‚ â€¢ 1s     - Price inserted âœ…                                 â”‚
â”‚ â€¢ 5min   - GPS coordinates added ğŸ—ºï¸                         â”‚
â”‚ â€¢ 15min  - USD conversion done ğŸ’±                            â”‚
â”‚                                                              â”‚
â”‚ Price is USABLE after 1 second!                              â”‚
â”‚ Full enrichment after 15 minutes.                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘‘ Master Product - ×”×¤×˜× ×˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ THE PROBLEM: Same Product, Different Names                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ‡®ğŸ‡± Israel:  "×—×œ×‘ ×ª× ×•×‘×” 3% 1 ×œ×™×˜×¨"
ğŸ‡ºğŸ‡¸ USA:     "Tnuva Milk 3% Fat 1L"
ğŸ‡ªğŸ‡º Europe:  "Lait Tnuva 3% MG 1L"
ğŸŒ Asia:     "Tnuva ãƒŸãƒ«ã‚¯ 3% 1L"

âŒ Without Master Product:
   â†’ Can't compare across stores
   â†’ Can't compare across countries
   â†’ Price data is USELESS!

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ THE SOLUTION: Master Product                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Master Product     â”‚
                    â”‚  "tnuva-milk-3pct"  â”‚
                    â”‚                     â”‚
                    â”‚  Global EAN:        â”‚
                    â”‚  7290000000001      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                  â”‚                  â”‚
            â–¼                  â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ IL Product   â”‚   â”‚ US Product   â”‚   â”‚ EU Product   â”‚
    â”‚ "×—×œ×‘ ×ª× ×•×‘×”"  â”‚   â”‚ "Tnuva Milk" â”‚   â”‚ "Lait Tnuva" â”‚
    â”‚ â‚ª5.90        â”‚   â”‚ $2.99        â”‚   â”‚ â‚¬2.49        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… With Master Product:
   â†’ Global price comparison
   â†’ Trend tracking
   â†’ Smart recommendations
   â†’ REAL VALUE!

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3 MATCHING STRATEGIES                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Strategy 1: Barcode Matching (70%)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fast & Accurate                â”‚
â”‚                                â”‚
â”‚ 1. Extract barcode             â”‚
â”‚    EAN: 7290000000001          â”‚
â”‚                                â”‚
â”‚ 2. Search master_products      â”‚
â”‚    WHERE global_ean = ?        â”‚
â”‚                                â”‚
â”‚ 3. Link if found               â”‚
â”‚    confidence: 0.99            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Strategy 2: AI Embeddings (25%)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Semantic Similarity            â”‚
â”‚                                â”‚
â”‚ 1. Generate embedding          â”‚
â”‚    "×—×œ×‘ ×ª× ×•×‘×” 3%" â†’ [0.1, ...] â”‚
â”‚                                â”‚
â”‚ 2. Similarity search           â”‚
â”‚    cosine_similarity > 0.90    â”‚
â”‚                                â”‚
â”‚ 3. Link if match found         â”‚
â”‚    confidence: 0.85-0.95       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Strategy 3: LLM Creation (5%)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GPT-4 Analysis                 â”‚
â”‚                                â”‚
â”‚ 1. Extract attributes          â”‚
â”‚    {                           â”‚
â”‚      brand: "Tnuva",           â”‚
â”‚      type: "Milk",             â”‚
â”‚      fat: "3%",                â”‚
â”‚      volume: "1L"              â”‚
â”‚    }                           â”‚
â”‚                                â”‚
â”‚ 2. Generate master_id          â”‚
â”‚    "tnuva-milk-3pct-1l"        â”‚
â”‚                                â”‚
â”‚ 3. Create new master           â”‚
â”‚    confidence: 0.80            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CORE TABLES                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  store_chains    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id               â”‚ PK
â”‚ name             â”‚ "×¨××™ ×œ×•×™"
â”‚ chain_code       â”‚ "7290027600007"
â”‚ country          â”‚ "IL"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     stores       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id               â”‚ PK
â”‚ chain_id         â”‚ FK â†’ store_chains
â”‚ store_id         â”‚ "001"
â”‚ name             â”‚ "×¨××™ ×œ×•×™ ×©×™×§××”"
â”‚ city             â”‚ "×ª×œ ××‘×™×‘"
â”‚ address          â”‚ "×“×¨×š ×× ×—× ×‘×’×™×Ÿ 132"
â”‚ latitude         â”‚ 32.0668
â”‚ longitude        â”‚ 34.7913
â”‚ geom             â”‚ POINT (PostGIS)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    products      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id               â”‚ PK
â”‚ name             â”‚ "×—×œ×‘ ×ª× ×•×‘×” 3% 1 ×œ×™×˜×¨"
â”‚ ean              â”‚ "7290000000001"
â”‚ manufacturer     â”‚ "×ª× ×•×‘×”"
â”‚ category_id      â”‚ FK â†’ categories
â”‚ vertical_id      â”‚ FK â†’ verticals
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ N:1
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ master_products  â”‚ ğŸ‘‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id               â”‚ PK
â”‚ master_id        â”‚ "tnuva-milk-3pct-1l"
â”‚ name             â”‚ "Tnuva Milk 3% 1L"
â”‚ global_ean       â”‚ "7290000000001"
â”‚ category         â”‚ "Dairy"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚product_master_   â”‚
â”‚     links        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id               â”‚ PK
â”‚ master_product_idâ”‚ FK â†’ master_products
â”‚ regional_product â”‚ FK â†’ products
â”‚ region           â”‚ "IL"
â”‚ confidence_score â”‚ 0.98
â”‚ match_method     â”‚ "barcode"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     prices       â”‚ ğŸ’° (BIG TABLE!)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id               â”‚ PK
â”‚ product_id       â”‚ FK â†’ products
â”‚ store_id         â”‚ FK â†’ stores
â”‚ master_product_idâ”‚ FK â†’ master_products ğŸ‘‘
â”‚ price            â”‚ 5.90
â”‚ currency         â”‚ "ILS"
â”‚ scraped_at       â”‚ 2025-12-21 23:00:00
â”‚ is_available     â”‚ TRUE
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Indexes:
â€¢ idx_prices_product_time (product_id, scraped_at DESC)
â€¢ idx_prices_master (master_product_id)
â€¢ idx_prices_store (store_id)
â€¢ idx_products_ean (ean)
â€¢ idx_stores_geom (geom) GIST
```

---

## ğŸš€ Performance Optimization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CACHING STRATEGY                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Redis Cache Layers:

Layer 1: Products (24h TTL)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key: "product:ean:7290000000001"â”‚
â”‚ Value: 54321                   â”‚
â”‚ Hit Rate: 99%! ğŸ¯              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 2: Stores (24h TTL)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key: "store:7290027600007_001" â”‚
â”‚ Value: 12345                   â”‚
â”‚ Hit Rate: 95%                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 3: Prices (1h TTL)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key: "price:54321:12345"       â”‚
â”‚ Value: "5.90:ILS"              â”‚
â”‚ Hit Rate: 80%                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 4: Geocoding (1 year TTL)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key: "geo:address_hash"        â”‚
â”‚ Value: "32.0668,34.7913"       â”‚
â”‚ Hit Rate: 99.9%                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BATCH PROCESSING                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Single Insert (Slow):
FOR EACH price:
    INSERT INTO prices (...) VALUES (...)
    
Time: 100,000 prices Ã— 10ms = 1,000 seconds (16 min!) âŒ

Batch Insert (Fast):
Queue = []
FOR EACH price:
    Queue.append(price)
    IF len(Queue) >= 1000:
        INSERT INTO prices (...) VALUES (...), (...), ...
        Queue = []
        
Time: 100,000 prices Ã· 1000 Ã— 100ms = 10 seconds! âœ…

Speed Improvement: 100x faster! ğŸš€
```

---

## ğŸ“Š System Metrics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PERFORMANCE METRICS                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Throughput:
â”œâ”€ 1 Price â†’ Available in 1 second
â”œâ”€ 1,000 Prices â†’ Available in 2 seconds
â”œâ”€ 100,000 Prices â†’ Available in 60 seconds
â””â”€ 1,000,000 Prices â†’ Available in 10 minutes

Cache Performance:
â”œâ”€ Hit Rate: 95-99%
â”œâ”€ Miss Penalty: 5-10ms (DB query)
â””â”€ Memory Usage: ~2GB

Database:
â”œâ”€ Size: ~50GB (1.1M prices)
â”œâ”€ Query Time: <100ms (with indexes)
â””â”€ Concurrent Users: 100+

Master Product Linking:
â”œâ”€ Barcode Match: 10ms (70%)
â”œâ”€ AI Embedding: 100ms (25%)
â””â”€ LLM Creation: 2s (5%)
```

---

×ª××¨×™×š: 21 ×“×¦××‘×¨ 2025
×’×¨×¡×”: 1.0
