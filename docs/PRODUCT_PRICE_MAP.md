# 🗺️ מפת מחירים חכמה (Smart Price Map Documentation)

## 📌 סקירה כללית
מפת המחירים בדף המוצר (`product.html`) עברה שדרוג משמעותי כדי להתמקד באיכות הנתונים ובחווית המשתמש.
במקום סתם להציג נקודות על המפה, המפה כעת מספרת סיפור: **איפה זול ואיפה יקר?**

## 🛠️ טכנולוגיות
1.  **Leaflet.js** - מנוע המפה הבסיסי.
2.  **Leaflet.heat** - שכבת ה-Heatmap.
3.  **Leaflet.markercluster** - שכבת האיחוד (Clustering).

## 🎨 לוגיקה ויזואלית

### 1. מפת חום (Heatmap) - "הפוך על הפוך"
בדר"כ מפות חום מציגות צפיפות (הרבה = אדום). אצלנו המטרה היא להבליט **מחיר נמוך**.
לכן, הלוגיקה הפוכה:
*   **עוצמת החום (Intensity)** נקבעת לפי: `1 / (ratio^2)` כאשר `ratio = מחיר / מחיר_מינימום`.
*   ככל שהמחיר קרוב יותר למינימום -> העוצמה גבוהה יותר.
*   **הספקטרום**:
    *   🟡 **צהוב/ירוק זוהר** (High Intensity) = אזור זול מאוד.
    *   🔵 **כחול/סגול** (Low Intensity) = אזור יקר.

### 2. איחוד חכם (Smart Clustering)
כאשר נקודות קרובות מדי (פחות מ-`45px`), הן מתאחדות לאייקון אחד.
בניגוד לסטנדרט שמציג "כמות פריטים" (למשל "12"), פיתחנו `iconCreateFunction` מותאם אישית:
*   הפונקציה סורקת את כל הסמנים (Markers) שבתוך הקבוצה.
*   היא מוצאת את **המחיר הנמוך ביותר** מביניהם.
*   האייקון מציג: **"החל מ-₪5.90"**.
*   צבע האייקון משתנה בהתאם לטיב המחיר (ירוק = המחיר הכי זול נמצא כאן).

### 3. סמנים (Markers)
הסמנים הבודדים הם כעת **Text Labels** נקיים ללא אייקונים מכבידים.
*   **CSS Class**: `.price-marker`
*   **עיצוב**: טקסט נקי, עם צל עדין לקריאות (Text Shadow).
*   **צבעים**:
    *   ירוק (`.price-text-cheap`) - המחיר הכי זול.
    *   חום/צהוב (`.price-text-avg`) - מחיר סביר (עד 20% מעל המינימום).
    *   אדום (`.price-text-exp`) - מחיר יקר.

## 📂 מבנה הקוד
הקוד נמצא ב-`frontend/product.html` בתוך פונקציית `initMap`.
הקפדנו על עקרון **Single Source of Truth**: כל הלוגיקה נמצאת בבלוק `<script>` אחד בסוף הקובץ, ואין שאריות קוד ב-Header.

```javascript
// דוגמה לחישוב האינטנסיביות למפת החום
const heatPoints = valid.map(p => {
    const ratio = p.price / minP; 
    let intensity = 1.0 / (ratio * ratio); // דעיכה ריבועית
    return [p.latitude, p.longitude, intensity];
});
```
