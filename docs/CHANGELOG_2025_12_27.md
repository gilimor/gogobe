# 📝 Changelog - 27 דצמבר 2025

## 🔧 תיקונים ושיפורים אחרונים - אינטגרציה גלובלית 🌍

### ✅ אינטגרציה עם טוקיו, יפן 🇯🇵 (Tokyo Central Wholesale Market)
**מה בוצע**:
- חובר מקור מידע רשמי: **Toyosu Market** (שוק הדגים הגדול בעולם).
- פותח `import_tokyo_now.py` ו-`tokyo_market_scraper.py` לשאיבת נתונים יומית.
- הוספה תמיכה במטבע **JPY (¥)**.
- עודכנו קואורדינטות מדויקות לשוק טויוסו (35.6465° N, 139.7876° E).
- **סטטוס**: פעיל, שואב מחירי דגים, פירות וירקות.

### ✅ אינטגרציה עם ספרד 🇪🇸 (Spain Fuel - Geoportal)
**מה בוצע**:
- חובר מקור מידע ממשלתי: **Geoportal Gasolineras**.
- נשאבו כ-**9,400 תחנות דלק** וכ-**230,000 מחירים**.
- הוספה תמיכה מליאה במיקום גיאוגרפי (Lat/Lon) לכל התחנות.
- הוספה תמיכה במטבע **EUR (€)**.
- **סטטוס**: פעיל, נתונים גלובליים במפה.

### ✅ אופטימיזציה דרמטית למפה (Map Performance) 🗺️
**הבעיה**: המפה (`map.html`) קרסה בטעינת 36,000 סניפים.
**הפתרון**:
- פותח Endpoint רזה ומהיר: `/api/stores/geo` (שיפור של פי 100 בביצועים).
- הטמעת **Leaflet MarkerCluster**: איגוד נקודות לאשכולות למניעת עומס על הדפדפן.
- עדכון `ParsedStore` לתמיכה מובנית בשדות `latitude` ו-`longitude`.

### ✅ שיפורים בממשק המשתמש (Frontend)
**דף מחירים (`prices.html`)**:
- ברירת המחדל לסינון מטבע שונתה מ-ILS ל-**All**.
- נוספו מטבעות לתצוגה ולסינון: **JPY (¥)**, **AUD (A$)**.

---

## 🚀 Session 2: Search Engine & Product Experience (Afternoon)

### ✅ מנוע חיפוש ביצועים גבוהים (High-Performance Search) ⚡
**הבעיה**: חיפוש טקסט רגיל קרס תחת עומס של מאות אלפי רשומות.
**הפתרון**:
- הטמעת **GIN Indexes** (pg_trgm) בבסיס הנתונים לחיפוש וקטורי מהיר.
- שכתוב הלוגיקה (`products.py`) לשיטת **Two-Step Fetch**: סינון מוצרים -> שליפת מחירים ממוקדת. מוריד עומס מ-O(N) ל-O(1).

### ✅ ארכיטקטורת Product-First 🛍️
**שינוי תפיסה**: מעבר ממסכי ניהול (Admin Tables) לחוויית משתמש של אתר קניות (Marketplace).
**מה בוצע**:
- **דף נחיתה חדש (`index.html`)**: מנוע חיפוש מרכזי, כרטיסיות מוצר חכמות.
- **דף מוצר ייעודי (`product.html`)**:
    - החליף את ה-Modal הצף.
    - כולל הכנה ל-SEO (H1, Meta Descriptions).
    - **Global Stats**: וידג'טים למדינה הכי זולה/יקרה ופער ארביטראז'.
    - **גרף היסטוריה**: תצוגה גרפית של מגמות מחיר (90 יום).
    - **AI Insights**: ניתוח טקסטואלי אוטומטי ("המחיר ירד ב-5%").

---

## 📊 סטטוס נוכחי
- **מדינות נתמכות**: ישראל 🇮🇱, איטליה 🇮🇹, צרפת 🇫🇷, אוסטרליה 🇦🇺, יפן 🇯🇵, ספרד 🇪🇸.
- **מטבעות**: ILS, USD, EUR, AUD, JPY.
- **סניפים במפה**: ~45,000 סניפים גלובליים עם מיקום מדויק.
- **טכנולוגיה**: FastAPI + PostgreSQL (Optimized GIN) + Vanilla JS Components.

---

## 🎨 Session 3: Map UX Refinement (V5) 🗺️

### ✅ מפת מחירים חכמה (Smart Price Map)
**הבעיה**: מפה רגילה עם עשרות מרקרים יוצרת עומס ("רעש ויזואלי") וחפיפות שלא ניתן לקרוא.
**הפתרון**:
1.  **Heatmap (מפת חום) הפוכה**:
    *   אזורים **זולים** (Cheap) = צבעים חמים (ירוק/צהוב זוהר).
    *   אזורים **יקרים** (Expensive) = צבעים קרים (כחול/סגול).
2.  **Smart Clustering (איגוד חכם)**:
    *   שימוש בספריית `Leaflet.markercluster`.
    *   במקום להציג עיגול עם מספר סתמי ("10"), המערכת מחשבת ומציגה **"החל מ-₪5.90"** (המחיר הכי נמוך בקבוצה).
3.  **Clean Markers**:
    *   הסרת האייקונים הגדולים (גביעים/גרפים) שהסתירו את המפה.
    *   הצגת המחיר נטו כטקסט עם צבע מותאם (ירוק לזול, אדום ליקר).

**תאריך**: 27 דצמבר 2025
**גרסה**: 2.0 - מהדורת חווית המשתמש (UX Revolution) 🚀
