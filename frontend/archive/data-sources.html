<!DOCTYPE html>
<html dir="rtl" lang="he">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>拽专转 转 - Gogobe</title>
    <link rel="stylesheet" href="/static/styles.css">
    <style>
        .main-nav {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0;
        }

        .nav-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
        }

        .nav-brand {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.3);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .sources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .source-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .source-header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 20px;
        }

        .source-header.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .source-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .source-body {
            padding: 20px;
        }

        .source-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        .info-label {
            color: #6b7280;
            font-size: 14px;
        }

        .info-value {
            font-weight: 600;
            color: #1f2937;
        }

        .stores-table {
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f9fafb;
            padding: 12px;
            text-align: right;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
    </style>
</head>

<script src="/static/nav.js"></script>
</head>

<body>
    <main-nav></main-nav>

    <div class="container">
        <div class="page-header">
            <h1>拽专转 转</h1>
            <p> 专 拽专转 注 注专转</p>
        </div>
        <div id="sources-content" class="loading">注 拽专转 转...</div>
    </div>

    <script>
        const API_BASE = '';

        async function loadDataSources() {
            try {
                const response = await fetch(`${API_BASE}/api/data-sources/stats`);
                const data = await response.json();
                const sources = data.sources || [];
                const stores = data.stores || [];

                const contentEl = document.getElementById('sources-content');

                // Display sources
                let html = '';

                if (sources.length > 0) {
                    html += `
                        <div class="sources-grid">
                            ${sources.map(source => `
                                <div class="source-card">
                                    <div class="source-header ${source.last_import ? 'active' : ''}">
                                        <div class="source-name">${escapeHtml(source.source_name || ' 砖')}</div>
                                    </div>
                                    <div class="source-body">
                                        <div class="source-info">
                                            <span class="info-label">爪专:</span>
                                            <span class="info-value">${source.total_products || 0}</span>
                                        </div>
                                        <div class="source-info">
                                            <span class="info-label">专:</span>
                                            <span class="info-value">${source.total_prices || 0}</span>
                                        </div>
                                        <div class="source-info">
                                            <span class="info-label">住驻:</span>
                                            <span class="info-value">${source.total_stores || 0}</span>
                                        </div>
                                        <div class="source-info">
                                            <span class="info-label"> 专:</span>
                                            <span class="info-value">${formatDate(source.last_import) || ' '}</span>
                                        </div>
                                        ${source.source_slug === 'kingstore' ? `
                                            <div class="source-info">
                                                <a href="https://kingstore.binaprojects.com/Main.aspx" target="_blank" style="color: #3b82f6; text-decoration: none;">
                                                     驻转 转专 KingStore
                                                </a>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                // Display stores import history
                if (stores.length > 0) {
                    html += `
                        <div class="stores-table">
                            <h2>住专转  驻 住祝</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>专砖转</th>
                                        <th>住祝</th>
                                        <th>注专</th>
                                        <th>爪专</th>
                                        <th>专</th>
                                        <th> 专</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${stores.map(store => `
                                        <tr>
                                            <td>${escapeHtml(store.chain_name || '-')}</td>
                                            <td>${escapeHtml(store.store_name_he || store.store_name || '-')}</td>
                                            <td>${escapeHtml(store.city || '-')}</td>
                                            <td>${store.products || 0}</td>
                                            <td>${store.prices || 0}</td>
                                            <td>${formatDate(store.last_import) || '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                }

                if (!html) {
                    html = '<p> 拽专转 转 </p>';
                }

                contentEl.innerHTML = html;

            } catch (error) {
                console.error('Failed to load data sources:', error);
                document.getElementById('sources-content').innerHTML =
                    '<p style="color: red;">砖 注转 拽专转 转</p>';
            }
        }

        function formatDate(dateStr) {
            if (!dateStr) return null;
            const date = new Date(dateStr);
            return date.toLocaleDateString('he-IL') + ' ' + date.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.addEventListener('DOMContentLoaded', loadDataSources);
    </script>
</body>

</html>